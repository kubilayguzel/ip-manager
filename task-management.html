<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Manager - İş Yönetimi</title>
    <style>
        /* CSS stilleri öncekiyle aynı, değişiklik yok */
    </style>
</head>
<body>
    <script type="module">
        import { authService, taskService, ipRecordsService, personsService, auth } from './firebase-config.js'; 

        class TaskManagementModule {
            constructor() {
                this.currentUser = null;
                this.allTasks = [];
                this.allUsers = [];
                this.allIpRecords = [];
                this.allPersons = [];
            }

            async init() {
                this.currentUser = authService.getCurrentUser();
                if (!this.currentUser || (this.currentUser.role !== 'superadmin' && this.currentUser.role !== 'admin')) {
                    alert('Bu sayfaya erişim yetkiniz yoktur.');
                    window.location.href = 'dashboard.html';
                    return;
                }
                this.updateUserInfo();
                this.setupEventListeners();
                await this.loadInitialData();
            }

            updateUserInfo() {
                if (this.currentUser) {
                    const userName = this.currentUser.displayName || this.currentUser.email.split('@')[0] || 'Kullanıcı';
                    const userRole = this.currentUser.role === 'admin' ? 'Yönetici' : this.currentUser.role === 'superadmin' ? 'Süper Yönetici' : 'Kullanıcı';
                    document.getElementById('userAvatar').textContent = userName.charAt(0).toUpperCase();
                    document.getElementById('userName').textContent = userName;
                    document.getElementById('userRole').textContent = userRole;
                }
            }

            async loadInitialData() {
                // ... veri yükleme metodları ...
                this.populateFilters();
                this.renderTasks();
            }
            
            setupEventListeners() {
                // ... olay dinleyicileri ...
            }
            
            renderTasks() {
                // ... görevleri render etme metodu ...
            }

            populateFilters() {
                const userFilter = document.getElementById('userFilter');
                userFilter.innerHTML = '<option value="all">Tüm Kullanıcılar</option>';
                this.allUsers.forEach(user => {
                    userFilter.innerHTML += `<option value="${user.id}">${user.displayName || user.email}</option>`;
                });
                
                const statusFilter = document.getElementById('statusFilter');
                statusFilter.innerHTML = `<option value="all">Tüm Durumlar</option>
                    <option value="open">Açık</option>
                    <option value="in_progress">Devam Ediyor</option>
                    <option value="pending_review">Gözden Geçiriliyor</option>
                    <option value="completed">Tamamlandı</option>`;
            }
            // ... diğer tüm metodlar ...
        }

        document.addEventListener('DOMContentLoaded', () => {
            let taskManagementModule;
            authService.auth.onAuthStateChanged(async (user) => {
                if (user || authService.getCurrentUser()) {
                    if (!taskManagementModule) {
                        taskManagementModule = new TaskManagementModule();
                        await taskManagementModule.init();
                    }
                } else {
                    window.location.href = 'index.html';
                }
            });
            // Akordiyon menü scripti
        });
    </script>
</body>
</html>